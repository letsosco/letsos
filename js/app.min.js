sv=function(n,t){var ot="1.52.07",nr=5,tr=12,st=994201,ir=9e3,rr=7e3,ur="LETSOS OVERHEAD",p={Labor:"L",Exp:"E",Both:"B"},l={Vacation:"V",Sick:"S",Holiday:"H",Overhead:"O"},ii={Typed:{Height:90},Draw:{Width:460,Height:195}},c={DFT:"ls-sts-blue",SUCCESS:"ls-sts-green",WARN:"ls-sts-yellow",FAIL:"ls-sts-red",EXP:"ls-sts-white"},ht={Raw:0,Uplded:1},w={Exp:{Id:0,Name:"Exp",Desc:"Expense",GrpNo:0},Equip:{Id:1,Name:"Equip",Desc:"Equipment Photo",GrpNo:2},Job:{Id:2,Name:"Job",Desc:"Job Photo",GrpNo:1},Safety:{Id:3,Name:"Safety",Desc:"Safety Photo",GrpNo:1}},ct={J1:21,J2:22,J3:23},lt=function(n){return Math.round((n||0)*100)/100},f={dn:function(n){return parseInt(kendo.toString(n,"yyyyMMdd"))||0},nd:function(n){return kendo.parseDate(n&&n.toString(),"yyyyMMdd")},dt:function(n){return parseInt(kendo.toString(n,"yyyyMMddHHmmss"))||0},td:function(n){return kendo.parseDate(n&&n.toString(),"yyyyMMddHHmmss")},nnow:function(n){return f.dt(n||new Date)},today:function(){var n=new Date;return n.setHours(0,0,0,0),n},weekdayName:function(n){if(!n)return"";var t=n.getDay();return'<span{0} class="ls-dim">{1}<\/span>'.formatWith(t>=1&&t<=5?"":' class="ls-alert"',["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t])},dui:function(n,t){return kendo.toString(kendo.parseDate(n),t||"d")},dui2:function(n){return n?f.dui(n)+" "+f.weekdayName(n):""},addDays:function(n,t){var i=t?new Date(t):new Date;return i.setDate(i.getDate()+n),i},addHrs:function(n,t){var i=t?new Date(t):new Date;return i.setHours(i.getHours()+n),i},nAdd:function(n,t){var i=t?f.td(t):new Date;return n&&i.setSeconds(i.getSeconds()+n),f.dt(i)},pd:function(){var t=new Date,n=new Date(t),i,r,u,e,o;return n.setDate(n.getDate()-(n.getDay()===0?7:n.getDay())+1),n.setHours(0,0,0,0),i=f.addDays(7,n),i.setSeconds(i.getSeconds()-1),r=f.addDays(-7,n),u=f.addDays(7,r),u.setSeconds(u.getSeconds()-1),e=nt.editDeadline,e||(e=f.addHrs(nr,n)),o=f.addHrs(tr,n),{uiFrom:t>o?n:r,uiTo:t>o?i:u,validFrom:t>e?n:r}}},fr=function(n,t){var i=f.nnow(),r=n.data().length,u=r?n.at(r-1).Ts:0;return i===u||t?f.nAdd(t||1,i):i},wt=function(n,t){if(n){var i=n.match(/\d/g).join("");i&&(document.location.href=(t?"sms":"tel")+":"+i)}},er=function(n){n&&(document.location.href="mailto:"+n)},r=localStorage,it=r.IsDemo==="true",v=document.URL.indexOf("jfenghost")===-1?"https://my.letsos.com":"",or=v==="",y=document.URL.substr(0,4).toLowerCase()!=="http",bt=function(){var t=kendo.support.mobileOS,n={};return n.pc=!t,n.phone=!n.pc&&!t.tablet,n.tablet=!n.pc&&!n.phone,n}(),g=function(){var t=kendo.support.mobileOS,n={};return n.android=t.android,n.ios=!n.android,n}(),rt={fs:null,getDirectory:function(n,t,i){var r=n.split("/").reverse(),u=rt.fs.root,f=function(n){u.getDirectory(n,{create:t},function(n){u=n;r.length>0?f(r.pop()):i&&i(n)},function(){})};f(r.pop())},getFile:function(n,t){window.resolveLocalFileSystemURL(n,function(n){t&&t(n)},function(){})},moveCopyFile:function(n,t,i,r,u,f){var e=this;e.getFile(n,function(n){e.getDirectory(t,!0,function(t){r?n.moveTo(t,i,function(n){u&&u(n,f)},function(){}):n.copyTo(t,i,function(n){u&&u(n,f)},function(){})})},function(){})},removeFile:function(n){this.getFile(n,function(n){n.remove()},function(){})}},ri=function(n,t){if(y){if(navigator.connection.type!==Connection.NONE)return!0}else if(navigator.onLine)return!0;return n||showMsg(t||"Internet connection is required for this function!"),!1},ui=function(){return r.length===0||r.SyncDate==="0"},b=function(n,t){var i=new kendo.data.DataSource({data:n.data()});return i.filter(t),i.view()},d=function(n,t){return b(n,t).length>0},at=openDatabase("WoDb","1.0","",5242880),u,kt=!1,vt=function(n){u&&(u.hideLoading(),u.changeLoadingMessage(n||"Please wait..."),u.showLoading())},e={from:null,vwMain:function(){u.navigate(e.from||"#vwMain","none");e.from=null},vwWo:function(){u.navigate("#vwWo")},vwWork:function(){u.navigate("#vwWork")},vwMatl:function(){u.navigate("#vwMatl")},vwLabor:function(){u.navigate("#vwLabor")},vwExp:function(){u.navigate("#vwExp")},vwEquipItem:function(){u.navigate("#vwEquipItem")},vwWorkItem:function(){u.navigate("#vwWorkItem")},vwMatlItem:function(){u.navigate("#vwMatlItem")},vwToolItem:function(){u.navigate("#vwToolItem")},vwLaborItem:function(){u.navigate("#vwLaborItem")},vwExpItem:function(){u.navigate("#vwExpItem")},vwSetting:function(){u.navigate("#vwSetting")},viewLoader:function(n){vt();setTimeout(function(){u.navigate(n,"none");u.hideLoading()},350)}},a={view:function(){var t=n(u.view().element).getKendoValidator();return t?t.validate():!0},input:function(t){var i=n(u.view().element).getKendoValidator();return i?i.validateInput(t):!0},btns:{inc:function(t){return t.every(function(t){var i=event,r;return t?(r=i&&n(i.srcElement).closest("a"),!(r&&r.hasClass(t))):!!i})},exc:function(n){return!a.btns.inc(n)}}},pi=function(){var n=u&&u.view().id;return!u||n==="#vwMain"||n==="/"},fi=function(){return parseInt(r.ChangeDate)>parseInt(r.SyncDate)};showMsg=function(t,i,r){if(t){var u=n("#msgblk");u.find("div").html(t).removeClass().addClass(i||c.WARN);u.slideDown(1e3);r||setTimeout(function(){u.slideUp(1e3)},Math.max(Math.ceil(t.length/14),4)*1e3)}};hideErrMsg=function(){u&&u.view().element.find(".k-invalid-msg").hide()};drawer={hide:function(t){n("#mainMenu").getKendoMobileDrawer().hide();t&&t()},viewLoader:function(n){vt();this.hide(e.viewLoader(n))}};toggleTab=function(){var t=function(t,i){n.each(t,function(t,r){n("#tabs [data-role=tab]").eq(r).toggle(i)})},r=i.isExp();t([1,2,5],i.isDispJob());t([3],r);t([4],!r);n("#tabs").getKendoMobileTabStrip().switchTo(0)};sigBtnGrpSelect=function(t){var i=t||0;hideErrMsg();n("#btngSig").getKendoMobileButtonGroup().select(i);n("#sig").toggle(i===0);n("#sig2").toggle(i===1)};stsIcon=function(n){if(n.Cat===p.Labor){var t=c.DFT;return n.IsCmp?!n.OhCd&&n.WoNo&&!di(n.WoNo)||(t=c.SUCCESS):n.PriEmpNo===-1?t=c.FAIL:n.IsSelf&&!n.OnSche&&(t=c.WARN),t}return n.PriEmpNo===-1?c.FAIL:c.EXP};addTkt=function(n){var t=i.ds.wos.add();t.Cat=n;t.Ts=f.nnow();t.RefEmpNo=i.setting.EmpNo;hi(t,!0);n===p.Exp&&showMsg("For ONE TYPE of expense and ONE EMPLOYEE.",c.SUCCESS)};showAction=function(t,r,u,f){var tt=kendo.template(n("#tmAct").html()),e=[],s=[],k,nt,w;switch(t){case"copyTkt":k=parseInt(r.data("key").split("|")[2]);di(k)||e.push({action:"sv.act."+t,text:"Add Ticket To Job"});break;case"activate":e.push({action:"sv.act."+t,text:"Activate Ticket?",note:"You should not activate the ticket unless the primary technician tells you so.",css:"ls-del-btn"});break;case"del.wo":e.push({action:"sv.act."+t,text:"Delete Ticket",css:"ls-del-btn"});break;case"del.equip":case"del.work":case"del.matl":case"del.tool":case"del.labor":case"del.exp":e.push({action:"sv.act."+t,text:"Confirm Deletion",css:"ls-del-btn"});break;case"sigDiscard":e.push({action:"sv.act."+t,text:"Discard Signature?",note:'Customer signature can only be saved when "Accept" button is clicked.',css:"ls-del-btn"});break;case"closeTkt":var v=i.isTktCmp(),d=i.isDisp(),o=i.wo;if(o.Labors||s.push("Alert: did you forget entering labor?"),v||e.push({action:"sv.act."+t+".only",text:"Close Ticket Only",note:(o.IsPri?"Only this ticket is closed.":"Ticket will be submitted to primary tech for review.")+' Job is still <span class="ls-alert">OPEN<\/span>.'}),(d||yt(o.JobNo))&&(e.push({action:"sv.act."+t+".addNew",text:(v?"":"Close Ticket & ")+"Add New",note:(v?"Add":(o.IsPri?"Close":"Submit")+" this ticket and add")+' a new ticket for <span class="ls-alert">THIS<\/span> job.'}),d&&(o.IsCmp||(vi()?o.Sig||s.push('Please be aware that customer signature has NOT been saved yet. Customer needs to press "Accept" button to save the signature.'):s.push("Warning: customer has not signed yet!")),o.OnSche&&o.IsPri))){var g=0,c=!1,l=!0;b(i.ds.wos,[{field:"Cat",operator:"eq",value:p.Labor},{field:"WoNo",operator:"eq",value:o.WoNo},{field:"IsCmp",operator:"eq",value:!1}]).forEach(function(n){n.IsSelf?g++:(c=!0,!l||ci(n)||n.Sig||(l=!1))});g<=1&&(!c||l)?e.push({action:"sv.act."+t+(c?".cmpWoConfirm":".cmpWo"),text:"Complete Work Order",css:"ls-hl-btn",note:'The entire Job is <span style="color:lawngreen">COMPLETED<\/span>.'}):s.push('"Complete Work Order" button will be visible only '+(c&&!l?"after secondary tech closes his ticket.":"when you are completing the last ticket of the work order."))}break;case"closeTktConfirm":e.push({action:"sv.act.closeTkt.cmpWo",text:"Confirmation",css:"ls-del-btn",note:"Complete entire job"});s.push("This job still has secondary tech's ticket. If the secondary tech is doing his own time on his mobile device, you need to make sure he has finished everything before you complete the job. You can review his ticket on your device or talk to him to verify. If you have verified or you are doing paperwork for secondary tech, then you can continue.");break;case"wohist":e.push({action:"sv.act."+t+".viewDispatch",text:"Service Report"});e.push({action:"sv.act."+t+".viewTtkt",text:"T-Ticket"});e.push({action:"sv.act."+t+".viewPhoto",text:"Job Photo"});e.push({action:"sv.act."+t+".viewCmtT",text:"Technician Comment"});break;case"jobNoHold":i.wo.IsSelf&&e.push({action:"sv.act."+t+".unlock",text:"Unlock Ticket To Edit",note:"Dispatcher should authorize first before unlocking.",css:"ls-del-btn"});i.isTktCmpSig()&&e.push({action:"sv.act."+t+".forcePushToServer",text:"Force Pushing To Server",note:"Caution: Do this only if server did not receive the synced data from your device."});break;case"custAccept":e.push({action:"sv.act."+t,text:"Confirmation",note:"I hereby acknowledge the man hours and materials used as listed hereon and agree to pay for the services detailed above within 10 days from receipt of invoice. Note: tools and materials may not reflect those listed on the final invoice."});s.push("Stop here if you are a technician! This button is for customer to click!");break;case"multiSelAll":e.push({action:"sv.act."+t+".sel",text:"Select all"});e.push({action:"sv.act."+t+".delSel",text:"De-select all"});break;case"multiSelLbrGrp":nt=u.my;e.push({action:"sv.act."+t,text:(nt?"Remove from":"Add to")+" my group"});break;case"srvImg":y&&e.push({action:"sv.act."+t+".addConfirm",text:"Add New",note:"Add a new photo using camera or picking an existing one",css:"ls-hl-btn"});i.ds.curimgs.data().length&&(y&&e.push({action:"sv.act."+t+".replaceConfirm",text:"Replace",note:"Replace this photo with a new one"}),e.push({action:"sv.act."+t+".delImgConfirm",text:"Delete",note:"Delete this photo and description",css:"ls-del-btn"}));break;case"getImgSource":e.push({action:"sv.act.srvImg.camera",text:"Camera",note:"Take photo by camera"});e.push({action:"sv.act.srvImg.gallery",text:"Gallery",note:"Pick an existing photo from album"});break;case"delImgConfirm":e.push({action:"sv.act.srvImg.del",text:"Confirmation",css:"ls-del-btn",note:"Delete photo and description"})}if(e.length){var h=n("ul[data-role=actionsheet]"),a=h.getKendoMobileActionSheet(),it=tt(e);a&&a.destroy();n("#app").append(it);h=n("ul[data-role=actionsheet]");f&&h.attr(f.name,f.val);kendo.init(h,kendo.mobile.ui);a=h.getKendoMobileActionSheet();a.open(r,u);s.length&&(w="",s.forEach(function(n){w+='<div class="ls-actsht-title">'+n+"<\/div>"}),setTimeout(function(){n("<div>"+w+"<\/div>").prependTo(".km-actionsheet-wrapper").hide().slideDown(500)},500))}};sig={pad:null,isDraw:function(){return n("#sig .clearButton").is(":visible")},setMode:function(t){var r,o,f,e;t=t||!1;i.isTktCmpSig()||(n(".typeIt").toggle(t),n(".drawIt, .typed").toggle(!t),r=n(window).width()-28,o=contH.get()-n("#sigBtns").height()-10,i.set("sig.width",t?Math.min(r,ii.Draw.Width):r),i.set("sig.height",t?Math.min(o,ii.Draw.Height):ii.Typed.Height));bt.phone&&(f=window.orientation,e=f===-90||f===90,n("#orienAlert").toggle(t&&!e),n("#btngSig, #sigTop").toggle(!t),n("div[data-role=footer]").toggle(!t||!e),u.view().id==="#vwSig"&&u.view().scroller.reset())}};lvmSel={init:function(t,i,r,u,f,e){var o=this,s=n(t);o._listview={lvEl:s,ds:s.getKendoMobileListView().dataSource,dsSel:u,fnSelA:f,fnSelB:e};o._compare={ds:i,fds:r}},set:function(t,i){var r=this,e=r._listview.lvEl,f=!!t,u=!1;f?u=!r._set(t,i,!0):n.each(e.find(".ls-sel"),function(t,f){r._set(n(f),i,!1)||(u=!0)});u&&showMsg((f?"Item":"Some item")+" cannot be selected because it already exists in the ticket. Locate and modify the entry instead.",c.FAIL)},autoSet:function(n,t){var i=this,f=i._listview.lvEl,r=f.find(" li[data-uid="+n.uid+"] .ls-sel"),e=r.hasClass("ls-sel-active"),u=t(n);e!==u&&i.set(r,u)},save:function(n){var t=this,i=t._listview,r=i.dsSel,u=r.data();return u.length===0?!1:(u.forEach(function(i){var r=n?n(i):i,u;r&&(u=t._compare.ds.add(r),u.id=0)}),r.data([]),i.ds.cancelChanges(),!0)},curDataItem:function(n){return this._listview.ds.getByUid(n.closest("li").data("uid"))},_listview:{lvEl:null,ds:null,dsSel:null,fnSelA:null,fnSelB:null},_compare:{ds:null,fds:[]},_set:function(n,t,i){var f=this,r=f.curDataItem(n),e=f._listview,s=e.fnSelA,u=e.dsSel,h=f._compare.ds,o=[],c;return(i&&(t=!r.isSel),e.fnSelB&&e.fnSelB(r,t),f._compare.fds.forEach(function(n){o.push({field:n,operator:"eq",value:r[n]})}),c=t&&h.data().length&&d(h,o),c)?!1:t===(r.isSel||!1)?!0:(r.isSel=t,n.toggleClass("ls-sel-active"),s&&s(r),t?(r.Ts=fr(u),u.add(r)):(u.filter(o),u.remove(u.view()[0])),!0)}};mbImg={cur:{needSvr:!1,cat:null,ts2:0,isAdd:!1,page:0,set:function(t,r){var f=this;f.cat=t;f.ts2=r;f.needSvr=!1;f.isAdd=!1;var e=b(i.ds.imgs,[{field:"Cat",operator:"eq",value:t},{field:"Ts2",operator:"eq",value:r}]),o=!!e.length,s=(y||o)&&!i.isTktCmp();if(!o)if(s)f.isAdd=!0;else{showMsg("No existing image can be found!");return}i.ds.curimgs.data(n.map(e,function(n){var o=i.ds.fes.get(n.Ts),u=n.toJSON(),s,e,h;return o?u.url=o.Uri:(f.needSvr=!0,e=i.wo.Ts,h=e.toString().substring(0,4),Object.keys(w).some(function(n){return s=w[n].Name,w[n].Id===t}),u.url="{0}/docimg/{1}/{2}/{3}".formatWith(v,s,h,mbImg.fileName(e,r,u.Ts))),u}));i.set("lock.imgAct",!s);u.navigate("#vwImg");i.ds.curimgs.data().length&&n("#srvImg").getKendoMobileScrollView().scrollTo(0)},pickSourceType:function(t){this.isAdd=t;showAction("getImgSource",n("#btnImgAct"))}},filePath:function(n,t){return["doc",n,t].join("/")},fileName:function(n,t,i){return[n,t,i].join("-")+".jpg"},capture:function(t){var o=i.wo.Ts,r=mbImg.cur.ts2,u=mbImg.cur.cat,e=mbImg.cur.isAdd,a=i.ds.curimgs,c=a.data().length,l=mbImg.cur.page,v=function(t,f,a){var y=i.img,w=i.ds.curimgs,p=i.ds.imgs,b={Ts:t,No:f,Desc:"",Cat:u,Ts2:r,url:a},v;e?w.add(b):(p.remove(p.get(y.Ts)),y.id=t,y.Ts=t,y.url=a);i.ds.fes.add({Ts:t,Ts1:o,Ts2:r,Cat:u,Uplded:!1,Uri:a});v=new h.Img;v.Ts=t;v.No=f;v.Cat=u;v.Ts2=r;e?p.add(v):(v.Desc=y.Desc,p.insert(f,v));s(i.ds.imgs,"wo.Imgs",function(){n("#srvImg").getKendoMobileScrollView().scrollTo(e?c:l)})};navigator.camera.getPicture(function(n){var t=f.nnow(),i=function(n,t){v(t.ts,t.pg,n.toURL())};rt.moveCopyFile(n,mbImg.filePath(ht.Raw,u),mbImg.fileName(o,r,t),!0,i,{ts:t,pg:e?c:l})},function(){},{destinationType:Camera.DestinationType.FILE_URI,encodingType:Camera.EncodingType.JPEG,sourceType:t?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY,quality:80,targetWidth:720,targetHeight:720,correctOrientation:!0})}};contH={get:function(){var t=u.view().element;return n(window).height()-t.find("header").height()},adj:function(){document.activeElement.blur();setTimeout(function(){n(document.body).height(window.innerHeight);!y&&g.ios&&window.scrollTo(0,0)},500)},setImgScrollerH:function(t){var i=t||n("#srvImg .ls-img-scroller:visible");i.length&&(i.height(contH.get()-56),i.getKendoMobileScroller().reset(),n("#srvImg").getKendoMobileScrollView().refresh())}};kendoSearchFix=function(t){t.bind("scroll",function(){var t=n(document.activeElement);t.is("[type=search]")&&t.blur()})};var k=n.parseJSON(r.myguys||null)||[],ei=function(){r.EmpNo&&i.set("setting",new h.Setting({EmpNo:parseInt(r.EmpNo),EmpName:r.EmpName,Ssn4:parseInt(r.Ssn4),Ver:ot,SyncDate:f.dui(f.td(r.SyncDate||f.nnow()),"G")}))},nt={editDeadline:null,ndDataItem:function(n){return n.Date=f.nd(n.Date),n},dnDataItem:function(n){var t=n.toJSON();return t.Date&&(t.Date=f.dn(t.Date)),t}},wi=function(t,r){i.set(r,t.data().length===0?null:JSON.stringify(n.map(t.data(),nt.dnDataItem)))},oi=function(){var n=u.view().id;return i[n.toLowerCase().replace("#vw","").replace("item","")]},si=function(){var n=oi();return!n||n.isNew()?!1:(n.Date||f.td(n.Ts))<f.pd().validFrom},dt={theme:"ios",display:bt.phone?"modal":"bubble",closeOnOverlay:!1},sr=function(t){var a=r.EntPkg,f=parseInt(r.DeptNo),v=i.ds.ohlist,y=t===p.Exp,u=[{Val:" ",Desc:"REGULAR JOB",JobNo:0,Cc:0}],e,o;!y&&a&&(e={vacation:r.EntPkg.substr(0,1)!=="0",sick:r.EntPkg.substr(2,1)!=="0",holiday:r.EntPkg.substr(4,1)!=="0"},e.vacation&&u.push({Val:l.Vacation,Desc:"VACATION PAY",JobNo:f,Cc:st}),e.sick&&u.push({Val:l.Sick,Desc:"SICK LEAVE PAY",JobNo:f,Cc:st}),e.holiday&&u.push({Val:l.Holiday,Desc:"HOLIDAY PAY",JobNo:f,Cc:st}));o={logic:"and",filters:[{field:"DeptNo",operator:"eq",value:f},{logic:"or",filters:[{field:"Cat",operator:"eq",value:p.Both},{field:"Cat",operator:"eq",value:t}]}]};n.each(b(v,o),function(n,t){u.push({Val:t.Id.toString(),Desc:t.Desc,JobNo:t.JobNo,Cc:t.Cc})});i.ds.tktTypes.data(u);var s=[],h=[],c=n("[name=nmTktType]");n.each(u,function(n,t){s.push(t.Val);h.push(t.Desc)});c.html(sv.helper.renderTmpl(n("#tmSelect"),u));c.mobiscroll("option","wheels",[[{keys:s,values:h}]])},bi=function(t){var e=f.pd().validFrom,u=i.wo.OhCd,o=function(t,i){for(var s=[],e=t,o=!1,h=r.EntPkg,a=h&&h.substr(4,1)!=="0",c=function(t){return n.parseJSON(r.Holidays).indexOf(t.getMonth()+1+"/"+t.getDate())!==-1};e<=i;)u===l.Vacation||u===l.Sick?o=[0,6].indexOf(e.getDay())!==-1||a&&c(e):u===l.Holiday&&(o=!c(e)),o||s.push(e),e=f.addDays(1,e);return s};return t||(t=u===l.Vacation||u===l.Holiday?f.addDays(30,e):u||ni(i.wo.JobNo)?new Date:f.addDays(6,e)),{start:e,end:t,dates:o(e,t)}},gt=function(n,t){var i=u.view().element.find(".ls-mobi-date"),r=bi(n),f=r.dates;i.mobiscroll("option","buttons",["set","cancel"]);i.mobiscroll("option","minDate",r.start);i.mobiscroll("option","maxDate",r.end);i.mobiscroll("option","invalid",[{start:r.start,end:r.end}]);f.length>0&&(i.mobiscroll("option","valid",f),t&&t(f))},ki=function(n,t){var i=n.parent();i.find("span").remove();i.append(sv.helper.fDate.weekdayName(t))},hr=function(i,r,u){var f=n.map(Object.keys(w),function(n){var t=w[n];return t.GrpNo===u?{Val:t.Id,Desc:t.Desc}:null});n("#"+i).html(sv.helper.renderTmpl(n("#tmSelect"),f)).mobiscroll().select(n.extend({},dt,{anchor:n("#"+r),rows:5,minWidth:150,inputClass:"ls-hidden",onSelect:function(n,i){var r;switch(u){case w.Job.GrpNo:r=0}r!==t&&mbImg.cur.set(parseInt(i.getValue()),r)}}))},ut=function(t,r,u){var f=function(){var r=new kendo.data.DataSource({data:i.ds.wos.data(),filter:{field:"IsCmp",operator:"eq",value:t},sort:[{field:"CustName",dir:"asc"},{field:"JobNo",dir:"asc"},{field:"Cc",dir:"asc"},{field:"WoNo",dir:"asc"},{field:"Cat",dir:"desc"},{field:"IsSelf",dir:"desc"},{field:"Ts",dir:"asc"}]}),f,e,o;r.fetch(function(){var s,h;if(t&&r.view().length===0){showMsg("No completed ticket is found!");return}s=1;r.view().forEach(function(n){f=n.CustName+n.JobNo+n.Cc+n.WoNo;f===e?n.GrpOrder=o:(n.GrpOrder=s,s++);e=f;o=n.GrpOrder});r.group({field:"GrpOrder"});h=n("#woList").getKendoMobileListView();h?h.setDataSource(r):n("#woList").kendoMobileListView({dataSource:r,template:n("#tmWo").html(),headerTemplate:"#= sv.helper.woList.header(data) #",click:function(n){i.show.wo(n)}}).getKendoMobileListView();u&&u()})};r?o.wo.read.list(function(n){i.ds.wos.data(n);f()}):f()},hi=function(r,f){nt.editDeadline=null;r.IsActivated===t&&(r.IsActivated=!r.IsSelf||r.isNew()||!r.OnSche||r.IsPri||r.OhCd||!ci(r),r.IsActivated||(r.IsSelf=!1));i.set("wo",r);sr(r.Cat);var o=i.ds;o.equips.data(r.Equips?n.parseJSON(r.Equips):[]);o.works.data(r.Works?n.parseJSON(r.Works).map(nt.ndDataItem):[]);o.matls.data(r.Matls?n.parseJSON(r.Matls):[]);o.tools.data(r.Tools?n.parseJSON(r.Tools):[]);o.labors.data(r.Labors?n.parseJSON(r.Labors).map(nt.ndDataItem):[]);o.exps.data(r.Exps?n.parseJSON(r.Exps).map(nt.ndDataItem):[]);o.imgs.data(r.Imgs?n.parseJSON(r.Imgs):[]);ti.reset();sig.pad.init();sig.setMode();sigBtnGrpSelect(0);f?u.navigate("#vwWo","none"):e.vwWo()},di=function(n){return n&&d(i.ds.wos,[{field:"WoNo",operator:"eq",value:n},{field:"IsCmpWo",operator:"eq",value:!0}])},ci=function(n){return!n.Works&&!n.Matls&&!n.Tools&&!n.Labors&&!n.Exps&&!n.Recomd&&!n.Misc},s=function(n,t,u,e,s){var h,c;return!e&&!a.view()?!1:n.hasChanges()?(h=!t,h||wi(n,t),s=s||i.wo,s.RevDate=f.nnow(),r.ChangeDate=s.RevDate,c=function(){e||i.ds.wos.sync();h?ut(i.viewCmp,!1,u):(e||n.sync(),u&&u())},s.isNew()?o.wo.create([s],c):o.wo.update([s],c),!0):(u&&u(),!0)},tt=function(n,t,u,f,e){var c,l;n.remove(t);var h=!u,s=i.ds.imgs,a=h?s.data():b(s,[{field:"Ts2",operator:"eq",value:t.Ts}]);if(a.length&&(a.forEach(function(n){s.remove(n)}),h||wi(s,"wo.Imgs")),t.isNew()){e();return}h?(ut(i.viewCmp),c=t.Ts,o.wo.destroy([c],e),l=r.DelCltKeys?JSON.parse(r.DelCltKeys):[],l.push(c),r.DelCltKeys=JSON.stringify(l)):f(n,u,e,!0)},ft=function(n,t,r){n.Ts=f.nnow();t&&i.set(t,n);r&&r()},li=function(n){return n.JobNo+"|"+n.Cc+"|"+n.WoNo},cr=function(n){return n>=8e5},lr=function(n,t){return n&&t&&!cr(n)&&d(i.ds.ohlist,[{field:"JobNo",operator:"eq",value:n},{field:"Cc",operator:"eq",value:t}])},ni=function(n){return n>=0&&n<1e3||n>=7e5&&n<=799999},yt=function(n){return n>=1e3&&n<7e5},ai=function(n,t){var r=i.ds.techlist.get(n);return r?t?r.Name+(r.Tel?' <a href="tel:{0}">{0}<\/a>'.formatWith(r.Tel):""):r.Name:""},vi=function(){return sig.isDraw()?sig.pad.getSignature().length===0?"":sig.pad.getSignatureString():i.wo.SigContact?"A":""},yi={set:function(){var n=[],t=[],u=i.setting.EmpNo,f=i.ds.techlist.data();f.forEach(function(i){var r=i.No,f=k.indexOf(r)!==-1;f&&t.push(r);n.push({No:r,Name:i.Name,my:f||u===r})});k=t;r.myguys=JSON.stringify(k);i.ds.laborsMultiE.data(n)},update:function(t){var u=t.context,s=u.No||t,f=!u.my,e=k.indexOf(u.No),o;if(f){if(e!==-1)return;k.push(s)}else{if(e===-1)return;k.splice(e,1)}r.myguys=JSON.stringify(k);u&&(u.set("my",f),o={No:u.No,Name:u.Name,my:f},i.ds.laborsMultiE.pushUpdate(o),n(t.target).toggleClass("ls-lbr-mygrp"))}},ti={set:function(n,t){var f=i.ds,u=f.toolsMulti;if(u.group(n?{field:"dummy"}:null),u.data().length){t&&t();return}var r=i.wo.JobNo,e=r===ct.J1||r===ct.J2||r===ct.J3,o=e?{field:r===ct.J1?"J1":r===ct.J2?"J2":"J3",operator:"eq",value:1}:[];u.data(b(f.toollist,o).map(function(n){return{Id:n.Id,Desc:n.Desc,Qty:null}}));t&&t()},reset:function(){i.ds.toolsMulti.data([])}},et=function(t){if(!kt){kt=!0;var s=f.nnow(),p=it,w=ui(),k=function(){var t=n.Deferred();return o.wo.read.changed(function(n){i.wo&&i.wo.forcePushToServer&&(n.push(i.wo.toJSON()),i.wo.forcePushToServer=!1);t.resolve(n)}),t.promise()},g=function(){var t=n.Deferred();return o.wo.read.cltKeys(function(n){var u={refEmpNo:i.setting.EmpNo,isDemo:p||it,syncDate:s,toolListDate:parseInt(r.ToolListDate),techListDate:parseInt(r.TechListDate),ohListDate:parseInt(r.OhListDate),ver:ot,platform:y?device.platform.toLowerCase()==="android"?1:2:0,osver:y?device.version:""},f=r.DelCltKeys?JSON.parse(r.DelCltKeys):[];t.resolve({info:u,cltKeys:n,delCltKeys:f})}),t.promise()},e=function(t,u,f,e,o,s){var h=n.Deferred(),c=u.Del&&u.Del.length||(f?u.Add&&u.Add.length||u.Upd&&u.Upd.length:u.AddUpd&&u.AddUpd.length);return c?t.destroy(u.Del,function(){f?t.create(u.Add,function(){t.update(u.Upd,function(){ut(i.viewCmp,!0);h.resolve()})}):t.createUpdate(u.AddUpd,function(){t.read(function(n){e.data(n);s&&s();r[o]=u.RevDate;h.resolve()})})}):h.resolve(),h.promise()},nt=function(n){e(o.wo,n.Wo,!0)},tt=function(n){e(o.tool,n.Tool,!1,i.ds.toollist,"ToolListDate")},ft=function(n){var t="TechListDate",u=function(){n.Tech.RevDate!==parseInt(r[t])&&yi.set()};e(o.tech,n.Tech,!1,i.ds.techlist,t,u)},et=function(n){e(o.oh,n.Oh,!1,i.ds.ohlist,"OhListDate")},st=function(){var t=i.ds.fes,u=b(t,{field:"Uplded",operator:"eq",value:!1}),f=new FileTransfer,r=new FileUploadOptions;return n.when.apply(n,n.map(u,function(i){var u=new n.Deferred,e=i.Cat,o=i.Uri,s=mbImg.fileName(i.Ts1,i.Ts2,i.Ts);return r.fileName=s,f.upload(o,v+"/api/z/mobile/upldimg/{0}/{1}".formatWith(e,i.Ts1),function(){rt.moveCopyFile(o,mbImg.filePath(ht.Uplded,e),s,!0,function(n){var r=t.get(i.Ts);r.Uplded=!0;r.Uri=n.toURL();u.resolve()})},function(n){showMsg("Error uploading photos: "+n.code)},r),u})).promise()},ct=function(){var t=i.ds.fes;n.map(t.data(),function(n){d(i.ds.wos,{field:"Ts",operator:"eq",value:n.Ts1})||t.remove(n)})},h=i.setting.EmpNo,l=i.setting.Ssn4,a=function(){kt=!1;u.hideLoading()};n.ajax({type:"POST",dataType:"json",contentType:"application/json",url:v+"/api/z/mobile/validateUser",data:JSON.stringify({refempno:h,ssn4:l})}).done(function(u){r.EmpNo=h;r.Ssn4=l;r.EmpName=u.EmpName;r.DeptNo=u.DeptNo;r.EntPkg=u.EntPkg;r.AvailV=u.AvailV;r.AvailS=u.AvailS;r.Holidays=JSON.stringify(u.Holidays);r.IsDemo=u.IsDemo;it=u.IsDemo;i.set("authened",!0);n.when(k(),g()).done(function(i,u){n.ajax({type:"POST",url:v+"/api/z/mobile/syncsvr",data:JSON.stringify({info:u.info,changedWos:i,cltKeys:u.cltKeys,deletedCltKeys:u.delCltKeys}),beforeSend:function(){vt("Syncing...")}}).done(function(i){n.when(nt(i),tt(i),ft(i),et(i)).done(function(){r.SyncDate=s;r.VerTgt=i.Ver;r.DelCltKeys="";(!r.DeviceId||i.NeedReRegisterPushNot)&&gi();t&&t();y&&i.AppUrl&&(n("#app").append('<div class="km-loader km-widget" data-role="loader" style="display: block;"><\/div>'),showMsg('New app update is available.<p><a href="{0}" onclick="sv.helper.appUpdate(event)" class="km-button">Download and Install Now<\/a><\/p>'.formatWith(i.AppUrl),c.FAIL,!0))})}).always(a)});!y||it||w||st().done(ct)}).fail(a)}},pt=function(n,t){if(or||kt||!i.authened||!ri(!0)||!pi()&&u&&u.view().id!=="#vwPdSum"){t&&t();return}if(r.VerTgt>ot||n)et(t);else{var e=parseInt(r.SyncDate);e&&f.dt(f.addHrs(-2))>e&&et(t)}},gi=function(){if(y&&!it&&i.authened){var t=PushNotification.init({android:{senderID:"31561045929"},ios:{alert:"true",sound:"true"}});t.on("registration",function(t){var u=t.registrationId;r.DeviceId=u;n.post(v+"/api/z/mobile/regDevId",JSON.stringify({refempno:i.setting.EmpNo,devid:u}))});t.on("notification",function(n){n.additionalData.forceBgSync&&pt(!0,function(){g.ios&&t.finish()})})}},o={init:function(){var t="Ts INTEGER PRIMARY KEY, RefEmpNo INTEGER, PriEmpNo INTEGER, OnSche INTEGER, JobNo INTEGER, Cc INTEGER, Cat, OhCd, Resp, RespTel, Reason, Equips, Works, Imgs, Recomd, CustName, CustPo, Addr, Contact, Tel, Matls, Labors, Exps, Tools, Misc, Sig, SigDate INTEGER, SigContact, SigTel, SigEmail, IsCmp INTEGER, CmtC, CmtT, IsCmpWo INTEGER, WoNo INTEGER, RevDate INTEGER",n=r.Ver||0;n&&n<ot&&at.transaction(function(n){n.executeSql("ALTER TABLE Tech ADD COLUMN Email");r.TechListDate=0;et()});at.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS Wo ({0})".formatWith(t));n.executeSql("CREATE TABLE IF NOT EXISTS Tech (No INTEGER PRIMARY KEY, Name, Tel, Email)");n.executeSql("CREATE TABLE IF NOT EXISTS Tool (Id INTEGER PRIMARY KEY, Desc, J1 INTEGER, J2 INTEGER, J3 INTEGER)");n.executeSql("CREATE TABLE IF NOT EXISTS Oh (Id INTEGER PRIMARY KEY, JobNo INTEGER, Cc INTEGER, Desc, DeptNo INTEGER, Cat)")})},dataToArray:function(n,t){for(var r,f=n.rows.length,u=[],i=0;i<f;i++)r=n.rows.item(i),u.push(t?r[t]:r);return u},crud:function(n,t,i,r,u,f,e){n?at.transaction(function(o){var s=n?n.length:0;if(s===0){t&&t();return}n.forEach(function(n,h){var c=h===s-1;o.executeSql(r,u(n),function(){c&&t&&t()},function(r,u){f?r.executeSql(f,e(n),function(){c&&t&&t()},function(n,t){i?i():console.log(t.message)}):i?i():console.log(u.message)})})}):at.transaction(function(n){n.executeSql(r,u,function(n,i){t&&t(i)})})},read:function(n,t,i){o.crud(null,n,null,t,i)},modify:function(n,t,i,r,u){o.crud(n,t,i,r,u,null,null)},delRcds:function(n,t,i,r){var u=t?t.length:0;if(u===0){i&&i();return}at.transaction(function(f){t.forEach(function(t,e){f.executeSql(n,[t],function(){e===u-1&&i&&i()},function(){r&&r()})})})},wo:{read:{list:function(t){o.read(function(r){for(var u,o=r.rows.length,e=[],f=0;f<o;f++)u=n.parseJSON(JSON.stringify(r.rows.item(f))),u.OnSche=u.OnSche===1,u.IsCmp=u.IsCmp===1,u.IsCmpWo=u.IsCmpWo===1,u.IsSelf=u.RefEmpNo===i.setting.EmpNo,u.IsPri=u.RefEmpNo===u.PriEmpNo,e.push(u);t(e)},"SELECT * FROM Wo",[])},single:function(n,t){o.read(function(n){t(n.rows.item(0))},"SELECT * FROM Wo WHERE Ts=?",[n])},changed:function(n){o.read(function(t){n(o.dataToArray(t))},"SELECT * FROM Wo WHERE RevDate>?",[r.SyncDate])},cltKeys:function(n){o.read(function(t){n(o.dataToArray(t))},"SELECT Ts, RevDate FROM Wo",[])},pdSum:function(t){o.read(function(r){for(var u,v=r.rows.length,e=i.setting.EmpNo,s=[e],h=[{IsSelf:!0,EmpNo:e,EmpName:i.setting.EmpName}],c=[],l=f.pd(),a=function(t,i){i&&n.parseJSON(i).forEach(function(n){var i=f.nd(n.Date);i>=l.uiFrom&&i<=l.uiTo&&n.No&&(n.EmpNo=n.No,n.WoTs=t.Ts,n.WoCat=t.Cat,n.OhCd=t.OhCd,n.JobNo=t.JobNo,n.Cc=t.Cc,n.WoNo=t.WoNo,n.CustName=t.CustName,n.Reason=t.Reason,n.Date=i,n.IsSelf=t.RefEmpNo===e,n.PriEmpNo=t.PriEmpNo,n.IsPri=t.PriEmpNo===t.RefEmpNo,n.StsIcon=stsIcon(t),s.indexOf(n.No)===-1&&(s.push(n.No),h.push({IsSelf:!1,EmpNo:n.No,EmpName:n.Name})),c.push(n))})},o=0;o<v;o++)u=r.rows.item(o),a(u,u.Labors),a(u,u.Exps);t({emplist:h,emptime:c})},"SELECT Ts, JobNo, Cc, Cat, OhCd, CustName, Reason, Labors, Exps, RefEmpNo, PriEmpNo, IsCmp, Sig, IsCmpWo, RevDate FROM Wo WHERE Labors>'' or Exps>''",[])}},create:function(n,t,i){o.modify(n,t,i,"INSERT INTO Wo (Ts, RefEmpNo, PriEmpNo, OnSche, JobNo, Cc, Cat, OhCd, Resp, RespTel, Reason, Equips, Works, Imgs, Recomd, CustName, CustPo, Addr, Contact, Tel, Matls, Labors, Exps, Tools, Misc, Sig, SigDate, SigContact, SigTel, SigEmail, IsCmp, CmtC, CmtT, IsCmpWo, WoNo, RevDate) VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",function(n){return[n.Ts,n.RefEmpNo,n.PriEmpNo,n.OnSche?1:0,n.JobNo,n.Cc,n.Cat,n.OhCd,n.Resp,n.RespTel,n.Reason,n.Equips,n.Works,n.Imgs,n.Recomd,n.CustName,n.CustPo,n.Addr,n.Contact,n.Tel,n.Matls,n.Labors,n.Exps,n.Tools,n.Misc,n.Sig,n.SigDate,n.SigContact,n.SigTel,n.SigEmail,n.IsCmp?1:0,n.CmtC,n.CmtT,n.IsCmpWo?1:0,n.WoNo,n.RevDate]})},update:function(n,t,i){o.modify(n,t,i,"UPDATE Wo SET RefEmpNo=?, PriEmpNo=?, OnSche=?, JobNo=?, Cc=?, Cat=?, OhCd=?, Resp=?, RespTel=?, Reason=?, Equips=?, Works=?, Imgs=?, Recomd=?, CustName=?, CustPo=?, Addr=?, Contact=?, Tel=?, Matls=?, Labors=?, Exps=?, Tools=?, Misc=?, Sig=?, SigDate=?, SigContact=?, SigTel=?, SigEmail=?, IsCmp=?, CmtC=?, CmtT=?, IsCmpWo=?, WoNo=?, RevDate=? WHERE Ts=?",function(n){return[n.RefEmpNo,n.PriEmpNo,n.OnSche?1:0,n.JobNo,n.Cc,n.Cat,n.OhCd,n.Resp,n.RespTel,n.Reason,n.Equips,n.Works,n.Imgs,n.Recomd,n.CustName,n.CustPo,n.Addr,n.Contact,n.Tel,n.Matls,n.Labors,n.Exps,n.Tools,n.Misc,n.Sig,n.SigDate,n.SigContact,n.SigTel,n.SigEmail,n.IsCmp?1:0,n.CmtC,n.CmtT,n.IsCmpWo?1:0,n.WoNo,n.RevDate,n.Ts]})},cmpWo:function(n,t){o.modify([n],t,null,"UPDATE Wo SET IsCmp=1, IsCmpWo=1 WHERE JobNo=? and Cc=? and WoNo=?",function(n){return[n.JobNo,n.Cc,n.WoNo]})},destroy:function(n,t){o.delRcds("DELETE FROM Wo WHERE Ts=?",n,t)}},tool:{read:function(n){o.read(function(t){n(o.dataToArray(t))},"SELECT * FROM Tool",[])},createUpdate:function(n,t,i){o.crud(n,t,i,"INSERT INTO Tool (Id, Desc, J1, J2, J3) VALUES(?, ?, ?, ?, ?)",function(n){return[n.Id,n.Desc,n.J1?1:0,n.J2?1:0,n.J3?1:0]},"UPDATE Tool SET Desc=?, J1=?, J2=?, J3=? WHERE Id=?",function(n){return[n.Desc,n.J1?1:0,n.J2?1:0,n.J3?1:0,n.Id]})},destroy:function(n,t){o.modify(n,t,null,"DELETE FROM Tool WHERE Id=?",function(n){return[n]})}},tech:{read:function(n){o.read(function(t){n(o.dataToArray(t))},"SELECT * FROM Tech",[])},createUpdate:function(n,t,i){o.crud(n,t,i,"INSERT INTO Tech (No, Name, Tel, Email) VALUES(?, ?, ?, ?)",function(n){return[n.RefEmpNo,n.DisplayName,n.Tel,n.Email]},"UPDATE Tech SET Name=?, Tel=?, Email=? WHERE No=?",function(n){return[n.DisplayName,n.Tel,n.Email,n.RefEmpNo]})},destroy:function(n,t){o.modify(n,t,null,"DELETE FROM Tech WHERE No=?",function(n){return[n]})}},oh:{read:function(n){o.read(function(t){n(o.dataToArray(t))},"SELECT * FROM Oh",[])},createUpdate:function(n,t,i){o.crud(n,t,i,"INSERT INTO Oh (Id, JobNo, Cc, Desc, DeptNo, Cat) VALUES(?, ?, ?, ?, ?, ?)",function(n){return[n.Id,n.JobNo,n.Cc,n.Desc,n.DeptNo,n.Cat]},"UPDATE Oh SET JobNo=?, Cc=?, Desc=?, DeptNo=?, Cat=? WHERE Id=?",function(n){return[n.JobNo,n.Cc,n.Desc,n.DeptNo,n.Cat,n.Id]})},destroy:function(n,t){o.modify(n,t,null,"DELETE FROM Oh WHERE Id=?",function(n){return[n]})}}},h={Wo:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},RefEmpNo:{type:"number"},PriEmpNo:{type:"number"},OnSche:{type:"boolean"},JobNo:{type:"number",nullable:!0},Cc:{type:"number",nullable:!0},Cat:{},OhCd:{defaultValue:""},Resp:{},RespTel:{},Reason:{},Equips:{},Works:{},Imgs:{},Recomd:{},CustName:{},CustPo:{},Addr:{},Contact:{},Tel:{},Matls:{},Labors:{},Exps:{},Tools:{},Misc:{},Sig:{},SigDate:{type:"number",nullable:!0},SigContact:{},SigTel:{},SigEmail:{},IsCmp:{type:"boolean"},CmtC:{},CmtT:{},IsCmpWo:{type:"boolean"},RevDate:{type:"number"},IsSelf:{type:"boolean",defaultValue:!0},IsPri:{type:"boolean"},IsActivated:{type:"boolean",defaultValue:!0}}}),Equip:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Mfr:{},Model:{},Serial:{},Loc:{},Spec:{}}}),Work:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Date:{type:"date"},Desc:{}}}),Matl:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},PoNo:{},Qty:{},Desc:{}}}),Tool:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Id:{type:"number"},Desc:{},Qty:{type:"number",defaultValue:1},Days:{type:"number",defaultValue:1}}}),Labor:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Cat:{defaultValue:""},Date:{type:"date"},No:{type:"number"},Name:{},ST:{type:"number",nullable:!0},OT:{type:"number",nullable:!0},DT:{type:"number",nullable:!0},TT:{type:"number",nullable:!0}}}),Oh:kendo.data.Model.define({id:"Id",fields:{Id:{type:"number"},Desc:{},JobNo:{type:"number"},Cc:{type:"number"},DeptNo:{type:"number"},Cat:{}}}),Emp:kendo.data.Model.define({id:"No",fields:{No:{type:"number"},Name:{},Tel:{},Email:{}}}),Setting:kendo.data.Model.define({fields:{EmpNo:{type:"number",nullable:!0},EmpName:{},Ssn4:{type:"number",nullable:!0},Ver:{},SyncDate:{}}}),AdvSearch:kendo.data.Model.define({fields:{Keyword:{},JobNo:{type:"number",nullable:!0},Cc:{type:"number",nullable:!0},Cust:{},Reason:{},Addr:{},Tech:{},Resp:{},OpDateF:{type:"date",nullable:!0},OpDateT:{type:"date",nullable:!0},CmDateF:{type:"date",nullable:!0},CmDateT:{type:"date",nullable:!0}}}),Img:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Cat:{type:"number"},Ts2:{type:"number"},No:{type:"number"},Desc:{}}}),Exp:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Date:{type:"date"},No:{type:"number"},Name:{},Desc:{},Amt:{type:"number",nullable:!0}}}),FileEntry:kendo.data.Model.define({id:"Ts",fields:{Ts:{type:"number"},Ts1:{type:"number"},Ts2:{type:"number"},Cat:{type:"number"},Uplded:{type:"boolean"},Uri:{}}}),LaborE:kendo.data.Model.define({id:"No",fields:{No:{type:"number"},Name:{},ST:{type:"number",nullable:!0},OT:{type:"number",nullable:!0},my:{type:"boolean"}}})},i=kendo.observable({viewCmp:!1,authened:!!r.EmpNo,isExp:function(){return i.get("wo.Cat")===p.Exp},isDisp:function(){return!i.get("wo.OhCd")&&ni(i.get("wo.JobNo"))},isDispJob:function(){return!i.get("isExp")()&&i.get("isDisp")()},isDispCons:function(){return i.get("isDisp")()||yt(i.get("wo.JobNo"))},isVSH:function(){var n=i.get("wo.OhCd");return n===l.Vacation||n===l.Sick||n===l.Holiday},isVSHE:function(){return i.get("wo.Cat")===p.Exp||i.isVSH()},isTktCmp:function(){return!i.get("wo.Unlock")&&(!i.get("wo.IsSelf")||i.get("wo.IsCmp"))},isTktCmpSig:function(){return!i.get("wo.Unlock")&&(!!i.get("wo.Sig")||i.isTktCmp())},deletable:!1,cont:{titleColor:function(){return i.get("viewCmp")?"#00ff00":"#ffffff"},custName:function(){return ni(i.get("wo.JobNo"))?"Cust. Name":"Job Name"},reason:function(){return i.isDisp()?"Reason For Call":"Work Performed/Description"},phReason:function(){return i.get("wo.Cat")===p.Exp||!yt(i.get("wo.JobNo"))||i.get("wo.Cc")===ir?"required":""},availHrVS:function(){var n=i.get("wo.OhCd")===l.Vacation?r.AvailV:r.AvailS;return(n>=0?n:'<span class="ls-alert">'+n+"<\/span>")+" hrs available up to last pay period"},tktOwner:function(){var t=i.get("wo.RefEmpNo"),n;return t===i.setting.EmpNo?"":(n=ai(t,!0),n?"Ticket Owner "+n:"Invalid ticket owner. Call office.")},priTech:function(){var t=i.get("wo.PriEmpNo"),n;return t===i.setting.EmpNo?"":(n=ai(t,!0),n?"Primary Tech "+n:"Invalid primary tech.")}},lock:{user:function(){return i.get("authened")&&!it},recomAdd:function(){return!!i.get("wo.Recomd")||i.isTktCmp()},cmp:function(){return!i.get("wo.IsSelf")||i.get("wo.IsCmpWo")||i.get("wo.PriEmpNo")<=0},ohcd:!0,jobcc:function(){return i.get("wo.OnSche")||i.isVSH()||i.isTktCmp()},disp:function(){return i.get("wo.OnSche")||i.isTktCmpSig()},tktOwner:function(){return i.get("wo.RefEmpNo")===i.setting.EmpNo},priTech:function(){return i.get("wo.PriEmpNo")===i.setting.EmpNo||i.get("wo.PriEmpNo")<=0},VS:function(){return i.get("wo.OhCd")!==l.Vacation&&i.get("wo.OhCd")!==l.Sick||i.isTktCmp()},dtl:!0,exp:!0,expAdd:!0,lbrSel:!0,invalidJobCc:function(){return i.get("wo.PriEmpNo")===-1},isRecomBlank:function(){return!i.get("wo.Recomd")},imgAct:!1,pdsum:{btns:!1}},jobCcChange:function(){if(a.input("[name=nmJobNo]")&&a.input("[name=nmCc]")){var t=i.wo,r=function(n){var t=n&&n.PriEmpNo!==-1;i.set("wo.PriEmpNo",t?0:-1);i.set("wo.OnSche",n?n.OnSche:!1);i.set("wo.WoNo",n?n.WoNo:0);i.set("wo.CustName",n?n.CustName:"");i.set("wo.Resp",n?n.Resp:"");i.set("wo.RespTel",n?n.RespTel:"");i.set("wo.Reason",n?n.Reason:"");i.set("wo.CustPo",n?n.CustPo:"");i.set("wo.Addr",n?n.Addr:"");i.set("wo.Contact",n?n.Contact:"");i.set("wo.Tel",n?n.Tel:"");i.set("wo.SigEmail",n?n.SigEmail:"");i.set("wo.IsPri",!1);hideErrMsg();toggleTab();ti.reset();n&&n.IsCmpWo&&showMsg("This work order is closed already! Make sure job# and cost code is correct",c.FAIL)};i.set("wo.OhCd",lr(t.JobNo,t.Cc)?l.Overhead:"");t.JobNo&&t.Cc?n.getJSON(v+"/api/z/mobile/getJobCcInfo",{jobNo:t.JobNo,cc:t.Cc,tktCat:t.Cat,ohcd:t.OhCd},function(n){r(n)}).error(function(){r()}):r()}},multiSel:{tap:function(n){i.multiSel._flag.isHold||lvmSel.set(n.touch.target)},holdSelAll:function(n){i.multiSel._flag.isHold=!0;showAction("multiSelAll",n.touch.target,null,{name:"data-close",val:"sv.vm.multiSel._flag.reset"})},holdLbr:function(n){if(!i.labor.isD){i.multiSel._flag.isHold=!0;var t=n.touch.target;showAction("multiSelLbrGrp",t,lvmSel.curDataItem(t),{name:"data-close",val:"sv.vm.multiSel._flag.reset"})}},input:function(t){var r=t.data,i=t.target,u=n(i).data("id"),f=function(){lvmSel.autoSet(r,function(n){var t=i.value;i.type==="number"&&(t=Number(t)||0);switch(u){case"toolQty":return n.Qty=t,t>0;case"lbrST":return n.ST=t,n.ST>0||n.OT>0;case"lbrOT":return n.OT=t,n.ST>0||n.OT>0}return!1})};f()},_flag:{isHold:!1,reset:function(){i.multiSel._flag.isHold=!1}}},sig:{width:0,height:0},wo:{},equip:{},work:{},matl:{},tool:{},labor:{},exp:{},img:{},setting:{},advSearch:{},ds:{wos:new kendo.data.DataSource({schema:{model:h.Wo}}),equips:new kendo.data.DataSource({schema:{model:h.Equip},sort:{field:"Ts",dir:"asc"}}),works:new kendo.data.DataSource({schema:{model:h.Work},sort:[{field:"Date",dir:"asc"},{field:"Ts",dir:"asc"}]}),matls:new kendo.data.DataSource({schema:{model:h.Matl},sort:{field:"Ts",dir:"asc"}}),tools:new kendo.data.DataSource({schema:{model:h.Tool},sort:{field:"Ts",dir:"asc"}}),labors:new kendo.data.DataSource({schema:{model:h.Labor},sort:[{field:"Name",dir:"asc"},{field:"Cat",dir:"asc"}],group:{field:"Date"}}),exps:new kendo.data.DataSource({schema:{model:h.Exp},sort:[{field:"Name",dir:"asc"},{field:"Date",dir:"asc"},{field:"Ts",dir:"asc"}],group:{field:"No"}}),curimgs:new kendo.data.DataSource({schema:{model:h.Img},sort:{field:"No",dir:"asc"}}),imgs:new kendo.data.DataSource({schema:{model:h.Img},sort:[{field:"Cat",dir:"asc"},{field:"Ts2",dir:"asc"},{field:"No",dir:"asc"}],change:function(n){if(n.action==="remove"){var t=i.ds.fes.get(n.items[0].Ts);t&&i.ds.fes.remove(t)}}}),fes:new kendo.data.DataSource({schema:{model:h.FileEntry},change:function(n){n.action==="remove"&&rt.removeFile(n.items[0].Uri)}}),toollist:new kendo.data.DataSource({sort:{field:"Desc",dir:"asc"}}),techlist:new kendo.data.DataSource({schema:{model:h.Emp},sort:{field:"Name",dir:"asc"}}),ohlist:new kendo.data.DataSource({schema:{model:h.Oh}}),tktTypes:new kendo.data.DataSource,techCmtHist:new kendo.data.DataSource,hist:new kendo.data.DataSource({transport:{read:{url:v+"/api/z/mobile/searchhist",type:"POST"},parameterMap:function(n){var i,t,r;if(n.filter)return t=n.filter.filters[0].value,i=typeof t=="object"?t:new h.AdvSearch({Keyword:t}),r={cri:i,count:n.pageSize,page:n.page},JSON.stringify(r)}},serverPaging:!0,serverFiltering:!0,pageSize:150,schema:{data:"Results",total:"Total"},requestStart:function(n){n.sender._filter||n.preventDefault()},requestEnd:function(n){n.response&&n.response.Total||showMsg("no record is found!")}}),timesheet:new kendo.data.DataSource,laborsMultiD:new kendo.data.DataSource({schema:{model:h.Labor},group:"dummy",sort:{field:"Date",dir:"asc"}}),laborsMultiE:new kendo.data.DataSource({schema:{model:h.LaborE},group:"dummy",sort:[{field:"my",dir:"desc"},{field:"Name",dir:"asc"}]}),toolsMulti:new kendo.data.DataSource({schema:{model:h.Tool},sort:{field:"Desc",dir:"asc"}}),pdSumEmpList:new kendo.data.DataSource({sort:[{field:"IsSelf",dir:"desc"},{field:"EmpName",dir:"asc"}]}),pdSumEmpTime:function(){var n=[{field:"ST",aggregate:"sum"},{field:"OT",aggregate:"sum"},{field:"DT",aggregate:"sum"},{field:"TT",aggregate:"sum"},{field:"Amt",aggregate:"sum"}];return new kendo.data.DataSource({aggregate:n,group:{field:"Date",aggregates:n}})}()},mainMenu:{tgView:function(){drawer.hide();var n=!i.viewCmp;ut(n,!1,function(){var t=u.view(),r=n?"Completed":"Active";t.header.find('[data-role="navbar"]').getKendoMobileNavBar().title(r);t.options.title=r;i.set("viewCmp",n);t.scroller.reset()})},addTktL:function(){addTkt(p.Labor)},addTktE:function(){addTkt(p.Exp)},timesheet:function(){n.getJSON(v+"/api/z/mobile/searchtimesheet",{refEmpNo:i.setting.EmpNo},function(n){i.ds.timesheet.data(n);u.navigate("#vwTimesheet")});drawer.hide()},techDir:function(){drawer.viewLoader("#vwTechDir")}},show:{wo:function(n){hi(i.ds.wos.get(n.dataItem.Ts))},equip:function(n){i.set("equip",n.dataItem);e.vwEquipItem()},work:function(n){i.set("work",n.data);e.vwWorkItem()},matl:function(n){i.set("matl",n.dataItem);e.vwMatlItem()},tool:function(n){i.set("tool",n.dataItem);e.vwToolItem()},labor:function(n){i.set("labor",n.dataItem);e.vwLaborItem()},exp:function(n){i.set("exp",n.dataItem);e.vwExpItem()},img:{catWo:function(){s(i.ds.wos,"",function(){n("#imgCatWo").mobiscroll("show")})},catEquip:function(){s(i.ds.equips,"wo.Equips",function(){mbImg.cur.set(w.Equip.Id,i.equip.Ts)})},exp:function(){var n=function(){mbImg.cur.set(w.Exp.Id,i.exp.Ts)};y&&i.exp.isNew()?s(i.ds.exps,"wo.Exps",n):n()},act:function(n){showAction("srvImg",n.button)}},toolsearch:function(){ti.set(!1,function(){n("#diaToolSearch").getKendoMobileModalView().open()})},techsearch:function(){n("#diaTechSearch").getKendoMobileModalView().open()},calc:function(t){calc.reset();n("#diaCalc").getKendoMobileModalView().open();t.preventDefault()},setting:function(){e.vwSetting()},cmtD:function(){n.getJSON(v+"/api/z/mobile/viewTtkt",{jobno:i.wo.JobNo,costcode:i.wo.Cc},function(t){if(!t.CmtD1&&!t.CmtD2){showMsg("T-Ticket is empty.");return}n("#cmtD1").text(t.CmtD1);n("#cmtD2").text(t.CmtD2);u.navigate("#vwCmtD")})},map:function(){var n="http://maps.google.com/?q={0}";y&&(n=g.android?"geo:0,0?q={0}":"http://maps.apple.com/?q={0}");sv.helper.clickExtLink(n.formatWith(encodeURIComponent(i.wo.Addr)))},advSearch:function(){var t=i.ds.hist,n=i.advSearch.toJSON();n.OpDateF=f.dui(n.OpDateF);n.OpDateT=f.dui(n.OpDateT);n.CmDateF=f.dui(n.CmDateF);n.CmDateT=f.dui(n.CmDateT);t.filter({field:"keywordObj",operator:"eq",value:n});u.navigate("#vwHist")},recomd:function(t){n("#recomdWrapper").show("slow");t.button.hide()},pdSum:{refresh:function(t){var v=i.ds.pdSumEmpList,y=v.total()-1,s=t&&t.item,p=t&&t.button,h=n("#lstPdSumEmp"),w=Math.min(h.data("selidx"),y),o=s?t.item.index():p?w+(t.button.index()===0?-1:1):w,l=v.view()[o],g=l&&l.EmpNo||i.setting.EmpNo,nt=(l&&l.EmpName||i.setting.EmpName).toUpperCase(),r=i.ds.pdSumEmpTime,b=f.pd(),k=n("#pdSumList").getKendoMobileListView(),a=[{field:"EmpNo",operator:"eq",value:g}];r.filter(a);s&&n("#pdSumMenu").getKendoMobileDrawer().hide();(p||s)&&u.view().scroller.reset();n("#prev-pdsum").getKendoMobileButton().enable(o!==0);n("#next-pdsum").getKendoMobileButton().enable(o!==y);h.data("selidx",o);h.find(".ls-alert").toggleClass("ls-alert");(s||n(h.getKendoMobileListView().items()[o])).toggleClass("ls-alert");n("#wkTot").html(sv.helper.pdSumListHeader("<span>{0}<\/span><br />{1}~{2}".formatWith(nt,f.dui(b.uiFrom),f.dui(b.uiTo)),r.aggregates().ST.sum,r.aggregates().TT.sum,r.aggregates().OT.sum,r.aggregates().DT.sum,r.aggregates().Amt.sum));k?k.setDataSource(r):n("#pdSumList").kendoMobileListView({dataSource:r,headerTemplate:'<div class="ls-group-title">#= sv.helper.pdSumListHeader(sv.helper.fDate.dui2(data.value), data.aggregates.ST.sum, data.aggregates.TT.sum, data.aggregates.OT.sum, data.aggregates.DT.sum, data.aggregates.Amt.sum) #<\/div>',template:n("#tmPdSum").html(),click:function(n){e.from="#vwPdSum";hi(i.ds.wos.get(n.dataItem.WoTs))}});a.push({field:"PriEmpNo",operator:"eq",value:-1});d(r,a)&&showMsg("Invalid ticket will NOT be paid! Call office ASAP to correct!",c.FAIL)},backToMain:function(){n("#lstPdSumEmp").data("selidx",0);e.vwMain()}}},add:{equip:function(){ft(i.ds.equips.add(),"equip",e.vwEquipItem)},work:function(){if(a.view()){var n=i.ds.works.add();n.Date=f.today();ft(n,"work",e.vwWorkItem)}},matl:function(){ft(i.ds.matls.add(),"matl",e.vwMatlItem)},tool:function(){ft(i.ds.tools.add(),"tool",e.vwToolItem)},labor:function(n){if(a.bfAddLaborItem()){var t=i.ds.labors.add(),r=n.button.data("dftdate");t.Date=r?f.nd(r):f.today();t.No=i.setting.EmpNo;t.Name=i.setting.EmpName;ft(t,"labor",e.vwLaborItem)}},exp:function(){var n=i.ds.exps.add();n.Date=f.today();n.No=i.setting.EmpNo;n.Name=i.setting.EmpName;ft(n,"exp",e.vwExpItem)},equips:function(t){n.getJSON(v+"/api/z/mobile/getEquipList",{jobno:i.wo.JobNo,costcode:i.wo.Cc},function(t){if(!t.length){showMsg("No equipment history can be found.");return}if(t.length===1)i.ds.equips.data(t),i.set("wo.Equips",JSON.stringify(t));else{var r="#equipSel",f=new kendo.data.DataSource({schema:{model:h.Equip},data:t}),e=new kendo.data.DataSource({schema:{model:h.Equip}});u.navigate("#vwEquips");n(r).getKendoMobileListView().setDataSource(f);lvmSel.init(r,i.ds.equips,["Mfr","Model","Serial"],e)}showMsg("Equip list may not be accurate. Please verify with actual and update if needed.",c.SUCCESS)});t.preventDefault()},tools:function(n){e.viewLoader("#vwTools");n.preventDefault()},labors:function(t){if(a.view()){var r=i.labor,u=t.button.data().d,o=u?"D":"E";r.isD=u;i.ds.labors.remove(r);n("#lbrSelTitle"+o).html("Job "+i.wo.JobNo+"-"+i.wo.Cc+(u?" for "+r.Name:" on "+f.dui2(r.Date))+" "+sv.helper.shiftDesc(r.Cat));e.viewLoader(u?"#vwLaborsD":"#vwLaborsE");t.preventDefault()}},expTkt:function(){sv.act.copyTkt(null,li(i.wo),p.Labor,null,p.Exp)}},save:{wo:function(){i.wo.Unlock&&i.set("wo.Unlock",!1);s(i.ds.wos,"",e.vwMain)},activate:function(n){showAction("activate",n.button)},sigBack:function(n){a.view()&&(!i.isTktCmpSig()&&vi()?showAction("sigDiscard",n.button):i.save.wo())},acceptC:function(n){if(n.preventDefault(),sig.isDraw()&&sig.pad.getSignature().length===0){showMsg("Handwritten signature is required at draw mode",c.FAIL);return}a.view()&&showAction("custAccept",n.button)},acceptT:function(n){n.preventDefault();a.view()&&showAction("closeTkt",n.button)},equip:function(){s(i.ds.equips,"wo.Equips",e.vwWork)},work:function(){s(i.ds.works,"wo.Works",e.vwWork)},matl:function(){s(i.ds.matls,"wo.Matls",e.vwMatl)},tool:function(){s(i.ds.tools,"wo.Tools",e.vwMatl)},labor:function(){s(i.ds.labors,"wo.Labors",e.vwLabor)},exp:function(){i.set("wo.Reason",i.exp.Name+" - "+i.exp.Desc);s(i.ds.exps,"wo.Exps",e.vwExp)},img:function(){s(i.ds.imgs,"wo.Imgs",function(){u.navigate("#:back")})},setting:function(){if(a.view()){if(!i.setting.dirty&&!ui()){e.vwMain();return}i.set("authened",!1);i.set("viewCmp",!1);et(function(){ei();e.vwMain();u.view().scroller.reset()})}},equips:function(){var t=function(n){return new h.Equip({Ts:n.Ts,Mfr:n.Mfr,Model:n.Model,Serial:n.Serial,Loc:n.Loc,Spec:n.Spec})},n=e.vwWork;lvmSel.save(t)?s(i.ds.equips,"wo.Equips",n):n()},tools:function(){var t=function(n){return n.Qty>0?new h.Tool({Ts:n.Ts,Id:n.Id,Desc:n.Desc,Qty:n.Qty,Days:n.Days}):null},n=e.vwMatl;lvmSel.save(t)?s(i.ds.tools,"wo.Tools",n):n()},labors:function(){var t=function(n){return n.ST||n.OT||n.DT||n.TT?new h.Labor({Ts:n.Ts,Cat:n.Cat,Date:n.Date,No:n.No,Name:n.Name,ST:n.ST,OT:n.OT,DT:n.DT,TT:n.TT}):null},n=e.vwLabor;lvmSel.save(t)?s(i.ds.labors,"wo.Labors",n):n()},calcResult:function(t){var r=oi(),i=calc.calculate();n.isNumeric(i)&&(r.set("Amt",lt(i)),sv.ui.closeModalView());t.preventDefault()}},del:{wo:function(n){showAction("del.wo",n.button)},equip:function(n){showAction("del.equip",n.button)},work:function(n){showAction("del.work",n.button)},matl:function(n){showAction("del.matl",n.button)},tool:function(n){showAction("del.tool",n.button)},labor:function(n){showAction("del.labor",n.button)},exp:function(n){showAction("del.exp",n.button)}},dial:{wo:function(){wt(i.wo.Tel)},resp:function(){wt(i.wo.RespTel)},sig:function(){wt(i.wo.SigTel)},tech:function(n){wt(n.button.data("tel"),n.button.data("sms"))}},email:{tech:function(n){er(n.button.data("email"))}},sync:function(){et()}});return{vm:i,init:function(){var t=ui(),s,f;t&&(r.ChangeDate=0,r.SyncDate=0,r.ToolListDate=0,r.TechListDate=0,r.OhListDate=0);o.init();r.Ver=ot;ei();kendo.UserEvents.defaultThreshold(20);u=new kendo.mobile.Application(document.body,{platform:"ios",initial:t?"vwSetting":"vwMain",statusBarStyle:"black-translucent",transition:"slide",loading:"<h1>Please wait...<\/h1>"});n.ajaxSetup({contentType:"application/json",dataType:"json",beforeSend:function(n){if(!ri()){n.abort();return}vt()},error:function(n){var u=n.status,f=n.responseText,t;if(u===401)r.clear(),i.set("authened",!1),e.vwSetting(),t="Invalid user name/passwod, or user is not an active Letsos employee.";else{try{t=JSON.parse(f).Message}catch(o){t=f}(u===500||t&&t.length>200)&&(t="Server may be temporally under maintenance or no internet connection. Please try again later.")}showMsg(t,c.FAIL)},complete:function(){u.hideLoading()}});n(document).on("click","input[type=search]",function(){this.select()});n(document).on("submit","form",function(){n("input[type=search]").blur()});if(kendo.data.binders.dateValue=kendo.data.Binder.extend({init:function(t,i,r){kendo.data.Binder.fn.init.call(this,t,i,r);var u=this;n(u.element).on("change",function(){u.change()})},refresh:function(){var t=this,i=t.bindings.dateValue.get(),u=kendo.toString(i,"M/d/yyyy"),r=n(t.element);r.val(u);ki(r,i)},change:function(){var t=this.element.value,n=kendo.parseDate(t,"M/d/yyyy");n&&this.bindings.dateValue.set(n)}}),contH.adj(),bt.phone||n("#diaTechSearch").css("width","25em"),window.addEventListener("orientationchange",function(){var n=function(){var n=u.view(),t=n.id;switch(t){case"#vwImg":contH.setImgScrollerH();break;case"#vwSig":if(!bt.phone)break;sig.setMode(sig.isDraw());sig.pad.clearCanvas()}},t=function(t){setTimeout(function(){n();t&&t()},200)};g.ios?(n(),contH.adj()):g.android&&t(contH.adj)}),y)document.addEventListener("resume",function(){pt()}),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(n){rt.fs=n;var t=mbImg.filePath("{0}","{1}"),r=function(n,t,r){var u=n.createReader();u.readEntries(function(n){n.forEach(function(n){if(n.isFile){var u=n.name.toLowerCase().replace(".jpg","").split("-");i.ds.fes.add({Ts:parseInt(u[2]),Ts1:parseInt(u[0]),Ts2:parseInt(u[1]),Cat:r,Uplded:t===ht.Uplded,Uri:n.toURL()})}})},function(){})};[ht.Raw,ht.Uplded].forEach(function(n){Object.keys(w).forEach(function(i){var u=w[i].Id;rt.getDirectory(t.formatWith(n,u),!1,function(t){r(t,n,u)})})})},function(n){showMsg("Error accessing local file system: "+n.target.error.code,c.FAIL)}),s=function(){return pt(fi())},g.android?(document.addEventListener("pause",s),document.addEventListener("backbutton",function(){if(pi())showMsg("Use device HOME button to close app",c.SUCCESS);else{var n=u.element.find("div[data-role=navbar]:visible:last .km-leftitem a"),t=n.attr("href"),i=n.data("click"),r=n.data("bind");if(t)u.navigate(t);else if(i||r){var e=function(n,t){for(var u=Array.prototype.slice.call(arguments,2),i=n.split("."),f=i.pop(),r=0;r<i.length;r++)t=t[i[r]];return t[f].apply(t,u)},o=function(){var n=r.split(",").filter(function(n){return n.substr(0,6)==="click:"});return n[0].substr(6).trim()},f=i||o(),s=f.substr(0,3)==="sv."?"":u.view().element.data("model")+".";document.activeElement.blur();e(s+f,window,n)}else navigator.app.backHistory()}})):document.addEventListener("resign",s),gi();else{if(f=window.location.hash.toLowerCase(),f==="")return;(!t&&f!=="#vwmain"||t&&f!=="#vwsetting")&&window.location.replace(v+"/m")}},ui:{vwInit:function(t){var s=t.view,r=s.id,e,f,u,it=function(n){return n.prop("required")&&!n.is(":hidden")?!!n.val().trim():!0},p,k;switch(r){case"/":case"#vwMain":o.oh.read(function(n){i.ds.ohlist.data(n)});o.tech.read(function(t){i.ds.techlist.data(t);n("#lstTechSearch").kendoMobileListView({dataSource:i.ds.techlist,template:n("#tmTechSearch").text(),filterable:{field:"Name",operator:"contains"},click:function(n){var t=oi();t.set("No",n.dataItem.No);t.set("Name",n.dataItem.Name);sv.ui.closeModalView()}})});o.tool.read(function(n){i.ds.toollist.data(n)});sig.pad=n("#sig").signaturePad({lineWidth:0});n("#btngSig").kendoMobileButtonGroup({select:function(){sigBtnGrpSelect(this.selectedIndex)},index:0});n("[name=nmTktType]").mobiscroll().select(n.extend({},dt,{rows:7,minWidth:250,onSelect:function(t,r){var u=b(i.ds.tktTypes,{field:"Val",operator:"eq",value:r.getValue()})[0],f=u.Val.trim()==="",e=n.isNumeric(u.Val)?ni(u.JobNo)?l.Overhead:"":u.Val.trim();i.set("wo.OhCd",e);i.set("wo.JobNo",f?0:u.JobNo);i.set("wo.Cc",f?0:u.Cc);i.set("wo.CustName",f?"":ur);i.set("wo.Reason",i.isVSH()?u.Desc:"");i.set("wo.Addr","");i.set("wo.PriEmpNo",0);i.set("wo.IsPri",!f);i.set("wo.WoNo",0);toggleTab();hideErrMsg()}}));n(".ls-mobi-date").mobiscroll().date(n.extend({},dt,{minWidth:[60,90,65],dateOrder:"MD dyy",onBeforeShow:function(t){t.setDate(n.mobiscroll.parseDate("m/d/yy",n(this).val()),!1)},onClose:function(t,i){i==="clear"&&ki(n(this),null)}}));ut(!1,!0,function(){y&&navigator.splashscreen.hide()});break;case"#vwWo":u=n(r).kendoValidator({rules:{required:it,custName:function(n){return n.is("[name=nmCustName]")?(u.options.messages.custName=i.cont.custName()+" is required",n.val()):!0},addr:function(n){return n.is("[name=nmAddr]")?n.val()||!i.isDispJob():!0},reason:function(n){return n.is("[name=nmReason]")&&n.is(":visible")?(u.options.messages.reason=i.cont.reason()+" is required",n.val()||n.attr("placeholder")===""):!0},notVSH:function(n){if(n.is("[name=nmJobNo]")){var t=i.wo,r=t.Cc,u=function(){return(r===st||r===st-99e4)&&["vacation","sick","holiday"].some(function(n){return t.Reason&&t.Reason.toLowerCase().indexOf(n)!==-1||t.CustName&&t.CustName.toLowerCase().indexOf(n)!==-1})};if(u())return!1}return!0},uniqueVSH:function(n){if(n.is("[name=nmTktType]")){f=i.ds.wos;var t=n.val(),r=i.wo;if(!r.IsCmp&&(t===l.Vacation||t===l.Sick||t===l.Holiday))return!d(f,[{field:"OhCd",operator:"eq",value:t},{field:"IsCmp",operator:"eq",value:!1},{field:"Ts",operator:"neq",value:r.Ts}])}return!0},warranty:function(n){return n.is("[name=nmReason]")&&n.is(":visible")&&i.wo.Cc===rr&&yt(i.wo.JobNo)?n.val().trim().replace(/\n/g,"").length>=25:!0}},messages:{notVSH:"Select entitlement from ticket type list",custName:"Customer name is required",reason:"Reason for call is required",addr:"Address is required",uniqueVSH:"Active ticket already exists",warranty:"Work Performed has to be at least 25 characters"}}).getKendoValidator();hr("imgCatWo","btnImgWo",w.Job.GrpNo);break;case"#vwWork":n(r).kendoValidator({validateOnBlur:!1,rules:{hasEquip:function(n){return n.is("[name=recomd]")?i.ds.equips.data().length!==0||a.btns.inc(["ls-addwork"]):!0}},messages:{hasEquip:"Enter equipment first. NA for none"}});break;case"#vwLabor":a.bfAddLaborItem=function(){var t=n("#lbrInvalid"),r=t.find("#lbrInvalidMsg");return i.isDisp()&&i.ds.works.data().length===0?(r.text("Enter work performed first"),t.show(),!1):i.wo.OhCd===l.Holiday&&bi().dates.length===0?(r.text("No public holiday is available"),t.show(),!1):!0};break;case"#vwSig":n(r).kendoValidator({validateOnBlur:!1,rules:{emails:function(n){var t,r,u;return n.is("[name=Email]")?(t=n.val(),!t)?!0:(r="[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,6}",u=new RegExp("^"+r+"(;\\n*"+r+")*;?$"),i.set("wo.SigEmail",t.replace(",",";").replace(" ","")),u.test(i.wo.SigEmail)):!0},workReq:function(n){return n.is("[name=Contact]")?!!i.wo.Works||!event||a.btns.inc(["ls-sig-accept"]):!0},toolReq:function(n){return n.is("[name=Contact]")?i.wo.Tools||!i.wo.Works||a.btns.inc(["ls-sig-accept","ls-sig-compl"]):!0},contactReq:function(n){return n.is("[name=Contact]")?n.val()!==""||a.btns.inc(["ls-sig-accept","ls-sig-draw"]):!0}},messages:{emails:"Invalid email address",workReq:"Work Performed is missing",toolReq:"Tool Rental is missing (NA for none)",contactReq:"Contact is required"}});break;case"#vwWorkItem":n(r).kendoValidator({rules:{desc:function(n){return n.is("[name=nmDesc]")?n.val().trim().replace(/\n/g,"").length>=25:!0}},messages:{desc:"Description has to be at least 25 characters"}});break;case"#vwEquipItem":case"#vwMatlItem":n(r).kendoValidator();break;case"#vwSetting":n(r).kendoValidator();y&&navigator.splashscreen.hide();break;case"#vwToolItem":n("#lstToolSearch").kendoMobileListView({dataSource:i.ds.toolsMulti,template:n("#tmSearch").html(),filterable:{field:"Desc",operator:"contains"},click:function(n){i.tool.set("Id",n.dataItem.Id);i.tool.set("Desc",n.dataItem.Desc);sv.ui.closeModalView()}});n(r).kendoValidator({validateOnBlur:!1,rules:{qtyAndDays:function(n){if(n.is("[name=nmToolQty]")){var t=i.tool.Desc.replace("/","").replace(" ","").toLowerCase(),r=t==="na"||t==="none";return r&&(i.set("tool.Qty",0),i.set("tool.Days",0)),r||i.tool.Qty&&i.tool.Days}return!0}},messages:{qtyAndDays:"Quantity/Days can not be zero"}});break;case"#vwLaborItem":case"#vwExpItem":p=r==="#vwLaborItem";p?(n("#shift").mobiscroll().select(n.extend({},dt,{rows:5,onSelect:function(n,t){i.set("labor.Cat",t.getValue().trim())}})),u=n(r).kendoValidator({validateOnBlur:!1,rules:{hrs:function(n){if(n.is("[name=ST]")){var t=u.options.messages,r=i.labor;if(!(i.labor.ST||i.labor.OT||i.labor.DT||i.labor.TT))return t.hrs="Can not leave all hours blank",!1;if(i.isVSH()){if((i.labor.ST||0)>10)return t.hrs="Total daily hours can not be over 10",!1}else if((i.labor.ST||0)+(i.labor.OT||0)+(i.labor.DT||0)+(i.labor.TT||0)>24)return t.hrs="Total daily hours can not be over 24",!1;if(!a.btns.inc(["ls-lbr-back",""])&&d(i.ds.labors,[{field:"Cat",operator:"eq",value:r.Cat},{field:"No",operator:"eq",value:r.No},{field:"Date",operator:"eq",value:r.Date},{field:"Ts",operator:"neq",value:r.Ts}]))return t.hrs="Tech exists on same date",!1}return!0}},messages:{hrs:"Error"}}).getKendoValidator()):(u=n(r).kendoValidator({rules:{hasImg:function(n){return n.is("[name=nmAmtExp]")?a.btns.inc(["ls-exp-back",""])||d(i.ds.imgs,{field:"Ts2",operator:"eq",value:i.exp.Ts}):!0}},messages:{hasImg:"Photo of the receipt is required"}}).getKendoValidator(),calc.init(y));break;case"#vwHist":e='<a href="\\#"><div class="ls-itm ls-ellipsis">#: JobNo #-#: Cc # #: CustName #<\/div><div class="ls-itm-dtl ls-font-normal ls-ellipsis">#: CmpDate # <span class="ls-font-normal">#: Reason #<\/span><\/div><\/a>';n("#lstHist").kendoMobileListView({dataSource:i.ds.hist,autoBind:!1,template:e,filterable:{autoFilter:!1,placeholder:"job-costcode or keyword(s)"},endlessScroll:!0,click:function(n){n&&(n.preventDefault(),showAction("wohist",n.target,{jobno:n.dataItem.JobNo,cc:n.dataItem.Cc,wo:n.dataItem.Wo}))}});k=s.element.find(".km-filter-wrap");k.css({"margin-right":"5.5em",overflow:"hidden"}).after('<div style="float:right; margin-top:-1.7em; margin-right:.5em; color: black;"><a href="#vwAdvSearch">advanced<\/a><\/div>');kendoSearchFix(s.scroller);break;case"#vwTimesheet":e='<a><span class="ls-itm"><span class="ls-font-normal">Week Ending<\/span> #= WkEnd #<\/span><\/a>';n("#lstTimesheet").kendoMobileListView({dataSource:i.ds.timesheet,template:e,click:function(t){t.preventDefault();n.getJSON(v+"/api/z/mobile/viewtimesheet",{refempno:i.setting.EmpNo,wkend:t.dataItem.WkEnd},function(n){sv.helper.clickExtLink(n)})}});break;case"#vwTechCmtHist":n("#lstTechCmtHist").kendoMobileListView({dataSource:i.ds.techCmtHist,template:"<div>#= CmtT #<\/div>"});break;case"#vwAdvSearch":i.set("advSearch",new h.AdvSearch);break;case"#vwEquips":showMsg("Tap the equipment to select. Press and hold to select or de-select all.",c.SUCCESS);break;case"#vwTools":showMsg("Tap the tool name to select. Change quantity if needed.",c.SUCCESS);break;case"#vwLaborsE":yi.set();break;case"#vwImg":f=i.ds.curimgs;var g=n("#prev-img"),nt=n("#next-img"),tt=n("#srvImg").kendoMobileScrollView({dataSource:f,template:n("#tmImg").html(),change:function(n){var t=f.data().length;g.toggle(t>1&&n.page>0);nt.toggle(t>1&&n.page<t-1);i.img=n.data[0];mbImg.cur.page=n.page;contH.setImgScrollerH(n.element.find(".ls-img-scroller"))}}).getKendoMobileScrollView();g.click(function(){tt.prev()});nt.click(function(){tt.next()});n("#vwImg").on("change",".ls-img-desc",function(){i.ds.imgs.get(i.img.Ts).set("Desc",n(this).val())});break;case"#vwTechDir":i.ds.techlist.query({filter:{logic:"or",filters:[{field:"Tel",operator:"isnotempty"},{field:"Email",operator:"isnotempty"}]},sort:{field:"Name",dir:"asc"}});n("#lstTechDir").kendoMobileListView({dataSource:i.ds.techlist.view(),template:n("#tmTechDir").html(),filterable:{field:"Name",ignoreCase:!0,operator:"contains"}})}},vwShow:function(t){var e=t.view,g=e.element,y=(new Date).getDay(),w=y===0||y===5||y===6,s,l,d,a,v;if(hideErrMsg(),g.find("textarea").height(10).data("autosize",!1).autosize(),s=window.location.hash,s){var nt=n(s==="/"?"#vwMain":s),b=nt.attr("data-level"),tt=e.element.attr("data-level");b>tt&&n.each(n("div[data-level="+b+"]"),function(t,i){var u=n(i),r=u.getKendoMobileView();r&&r.scroller&&r.scroller.reset()})}switch(e.id){case"/":case"#vwMain":i.wo=null;pt(w&&fi());break;case"#vwWo":var u=i.wo,it=u.isNew(),rt=ci(u);i.set("deletable",u.IsSelf&&(it||!u.OnSche&&rt)&&u.IsActivated);i.set("lock.ohcd",!u.IsSelf||u.JobNo);toggleTab();break;case"#vwExp":i.set("lock.expAdd",i.wo.Exps||i.isTktCmp());break;case"#vwWorkItem":i.set("lock.dtl",i.isTktCmpSig()||si());gt(new Date);break;case"#vwLaborItem":l=i.isTktCmpSig()||si();d=function(n){var t=n.map(function(n){return n.getTime()});i.labor.isNew()&&t.indexOf(f.today().getTime())===-1&&i.set("labor.Date",n[0])};i.set("lock.dtl",l);i.set("lock.lbrSel",l||!i.labor.isNew());gt(null,d);a=n("#shift").mobiscroll("getInst");a.setValue(i.labor.Cat||" ",!0);l?a.disable():a.enable();break;case"#vwExpItem":gt(new Date);i.set("lock.exp",i.isTktCmp()||si());break;case"#vwPdSum":o.wo.read.pdSum(function(n){i.ds.pdSumEmpList.data(n.emplist);i.ds.pdSumEmpTime.data(n.emptime);i.set("lock.pdsum.btns",n.emplist.length>1);i.show.pdSum.refresh();pt(w&&fi())});break;case"#vwAdvSearch":v=e.element.find(".ls-mobi-date");v.mobiscroll("option","buttons",["set","clear","cancel"]);v.mobiscroll("option","minDate",null);v.mobiscroll("option","maxDate",new Date);break;case"#vwSetting":ei();break;case"#vwTools":ti.set(!0,function(){var n=function(n){n.isSel?(n.Qty||n.set("Qty",1),n.Days=1):(n.set("Qty",null),n.Days=null)},t=kendo.data.DataSource.create({schema:{model:h.Tool}});lvmSel.init("#toolSel",i.ds.tools,["Id"],t,n)});break;case"#vwLaborsD":case"#vwLaborsE":var r=i.labor,p=r.isD,ut="#lbrSel"+(p?"D":"E"),ft=function(n,t){t&&(n.Cat=r.Cat,p?(n.No=r.No,n.Name=r.Name):n.Date=r.Date)},et=function(n){n.isSel?(n.ST||n.set("ST",r.ST),n.OT||n.set("OT",r.OT),n.DT=r.DT,n.TT=r.TT):(n.set("ST",null),n.set("OT",null),n.DT=null,n.TT=null)},ot=kendo.data.DataSource.create({schema:{model:h.Labor}});p?gt(null,function(n){i.ds.laborsMultiD.data(n.map(function(n){return{Date:n}}))}):(i.ds.laborsMultiE.filter(k.length>0?{field:"my",operator:"eq",value:!0}:[]),k.length===0&&showMsg("To speed up loading of this screen next time, press and hold the employee name to build up your group.",c.SUCCESS));lvmSel.init(ut,i.ds.labors,["Date","No","Cat"],ot,et,ft);break;case"#vwImg":mbImg.cur.needSvr&&!ri(!0)&&showMsg("You may not be able to view some or all images because there is no internet connection.",c.FAIL);mbImg.cur.isAdd&&showAction("getImgSource",n("#btnImgAct"))}},vwInitModal:function(){kendoSearchFix(this.element.getKendoMobileModalView().scroller)},tabSelect:function(n){document.activeElement.blur();var t=i.wo.isNew(),r=function(){t&&i.isExp()&&i.add.exp()};n.sender.currentItem().index()!==0||s(i.ds.wos,"",r)||n.preventDefault()},chgSigMode:function(){var n=sig.isDraw();if(n&&!a.view()){sig.pad.init();return}sig.setMode(n)},closeModalView:function(){n('div[data-role="modalview"]:visible').getKendoMobileModalView().close()}},act:{copyTkt:function(t,r,u,e,o){var y=i.ds.wos,w=t&&n(t.target),a=(r||w.data("key")).split("|"),b=parseInt(a[0]),k=parseInt(a[1]),d=parseInt(a[2]),g;u=u||w.data("cat");o=o||u;y.query({filter:[{field:"Cat",operator:"eq",value:u},{field:"JobNo",operator:"eq",value:b},{field:"Cc",operator:"eq",value:k},{field:"WoNo",operator:"eq",value:d}],sort:{field:"Ts",dir:"desc"}});var l=y.view()[0],h=i.ds.wos.add(),v=o===p.Exp;h.Ts=f.nnow();h.RefEmpNo=i.setting.EmpNo;h.Cat=o;h.OhCd=l.OhCd;h.JobNo=b;h.Cc=k;h.WoNo=d;h.CustName=l.CustName;h.OnSche=v?!1:l.OnSche;h.PriEmpNo=l.PriEmpNo;h.IsPri=l.IsPri;v||(h.Contact=l.Contact,h.Tel=l.Tel,h.CustPo=l.CustPo,h.Resp=l.Resp,h.RespTel=l.RespTel,h.Reason=yt(l.JobNo)?"":l.Reason,h.Addr=l.Addr,h.Equips=l.Equips,h.SigEmail=l.SigEmail);g=function(){e&&e();showMsg((v?"Expense":"Job")+" Ticket created. Verify Active ticket list.",c.SUCCESS)};s(i.ds.wos,"",g,!1,h)},activate:function(){i.set("wo.IsActivated",!0);i.set("wo.IsSelf",!0);i.ds.wos.sync()},del:{wo:function(){tt(i.ds.wos,i.wo,"",null,e.vwMain)},equip:function(){tt(i.ds.equips,i.equip,"wo.Equips",s,e.vwWork)},work:function(){tt(i.ds.works,i.work,"wo.Works",s,e.vwWork)},matl:function(){tt(i.ds.matls,i.matl,"wo.Matls",s,e.vwMatl)},tool:function(){tt(i.ds.tools,i.tool,"wo.Tools",s,e.vwMatl)},labor:function(){tt(i.ds.labors,i.labor,"wo.Labors",s,e.vwLabor)},exp:function(){i.set("wo.Reason","");tt(i.ds.exps,i.exp,"wo.Exps",s,e.vwExp)}},custAccept:function(){i.wo.Sig=vi();i.set("wo.SigDate",f.nnow());s(i.ds.wos,"",function(){sigBtnGrpSelect(1);sig.setMode();n("#btngSig").hide()})},closeTkt:{only:function(n,t){i.wo.IsPri?i.set("wo.IsCmp",!0):(i.set("wo.RefEmpNo",i.wo.PriEmpNo),i.set("wo.IsSelf",!1));s(i.ds.wos,"",function(){t?sv.act.copyTkt(null,li(i.wo),p.Labor,e.vwMain):e.vwMain()})},addNew:function(){sv.act.closeTkt.only(null,!0)},cmpWoConfirm:function(){showAction("closeTktConfirm",n("#btnCmpWo"))},cmpWo:function(){i.set("wo.IsCmp",!0);i.set("wo.IsCmpwo",!0);s(i.ds.wos,"",function(){o.wo.cmpWo(i.wo,function(){ut(i.viewCmp,!0,e.vwMain)})})}},jobNoHold:{unlock:function(){n.get(v+"/api/z/mobile/UnlockValidate",{ts:i.wo.Ts},function(n){showMsg("Unlocking ticket "+(n?"is successful":"failed or not allowed"),n?c.SUCCESS:c.FAIL);n&&(nt.editDeadline=f.addHrs(1),i.set("wo.Unlock",!0))})},forcePushToServer:function(){var n=i.wo;n.RevDate=f.nAdd(1,n.RevDate);n.forcePushToServer=!0;o.wo.update([n],et)}},sigDiscard:function(){i.save.wo()},wohist:{viewDispatch:function(t){n.getJSON(v+"/api/z/mobile/viewdispatchimg",{refempno:i.setting.EmpNo,jobno:t.context.jobno,costcode:t.context.cc,wo:t.context.wo},function(n){sv.helper.clickExtLink(n)})},viewTtkt:function(t){n.getJSON(v+"/api/z/mobile/viewttktimg",{refempno:i.setting.EmpNo,wo:t.context.wo},function(n){sv.helper.clickExtLink(n)})},viewPhoto:function(t){n.getJSON(v+"/api/z/mobile/viewphoto",{refempno:i.setting.EmpNo,wo:t.context.wo},function(n){sv.helper.clickExtLink(n)})},viewCmtT:function(t){n.getJSON(v+"/api/z/mobile/viewTechComment",{jobno:t.context.jobno,costcode:t.context.cc},function(n){i.ds.techCmtHist.data(n);u.navigate("#vwTechCmtHist")})}},multiSelAll:{sel:function(){lvmSel.set(null,!0)},delSel:function(){lvmSel.set(null,!1)}},multiSelLbrGrp:function(n){yi.update(n)},srvImg:{addConfirm:function(){mbImg.cur.pickSourceType(!0)},replaceConfirm:function(){mbImg.cur.pickSourceType(!1)},delImgConfirm:function(){showAction("delImgConfirm",n("#btnImgAct"))},camera:function(){mbImg.capture(!0)},gallery:function(){mbImg.capture(!1)},del:function(){var t=i.ds.curimgs,r=i.ds.imgs,f=i.img,e=b(t,{field:"No",operator:"gt",value:f.No});e.forEach(function(n){n.No--;var t=b(r,{field:"Ts",operator:"eq",value:n.Ts});t[0].No=n.No});var o=t.data().length-1,u=mbImg.cur.page,h=n("#srvImg").getKendoMobileScrollView();r.remove(r.get(f.Ts));s(r,"wo.Imgs",function(){t.remove(f);t.data().length&&h.scrollTo(u>0&&u===o?u-1:u)})}}},helper:{isPhoneGap:y,fDate:f,getTechName:ai,renderTmpl:function(n,t){return kendo.Template.compile(n.html())(t)},toTop:function(n){var i=n.button.closest("div[data-role=modalview]"),r=i.length?i:u.view().element,f=r.find("ul[data-role=listview]").getKendoMobileListView(),t=f._itemBinder;t.buffer&&(t.buffer.range(0),t.list.refresh());(r.getKendoMobileModalView()||u.view()).scroller.reset()},woList:{header:function(n){var t=n.items[0],i='<div class="ls-sts {0}"><\/div>'.formatWith(stsIcon(t));return('<div data-key="{0}" data-cat="{1}" data-role="touch" data-hold="sv.helper.woList.headerHold" class="ls-group-title">'+i+'<span>{2}-{3} <\/span><span class="ls-font-normal">{4}<\/span><\/div>').formatWith(li(t),t.Cat,t.JobNo,t.Cc,t.CustName)},headerHold:function(n){showAction("copyTkt",n.touch.target)}},jobNoHold:function(n){showAction("jobNoHold",n.touch.target)},pdSumListHeader:function(t,i,r,u,f,e){return'{0}<span style="margin-left:2em">{1}&nbsp;&nbsp;&nbsp;{2}<\/span>{3}'.formatWith(t,lt((i||0)+(r||0)+(u||0)+(f||0)),e?kendo.toString(e,"c2"):"",sv.helper.renderTmpl(n("#tmHr"),{WoCat:p.Labor,ST:lt((i||0)+(r||0)),OT:lt(u),DT:lt(f)}))},clickExtLink:function(n){window.open(n,y?"_system":"_blank")},appUpdate:function(n){var t,i,r;n.preventDefault();t=n.target.href;g.ios?sv.helper.clickExtLink(t):(i=function(n){u.hideLoading();showMsg(n,c.FAIL)},r=new FileTransfer,vt("Downloading..."),r.download(t,cordova.file.externalCacheDirectory+"Mobile.apk",function(n){u.hideLoading();window.plugins.webintent.startActivity({action:window.plugins.webintent.ACTION_VIEW,url:n.toURL(),type:"application/vnd.android.package-archive"},function(){},function(){i("Error launching app update")})},function(n){i("Error downloading app: error code "+n.code)},!0))},shiftDesc:function(n){return n?'(<span class="ls-alert">'+(n==="A"?"2":"3")+(n==="A"?"nd":"rd")+" Shift<\/span>)":""},working:function(n){return!n.IsCmp&&(n.Works||n.Matls||n.Labors||n.Exps)}}}}(jQuery);String.prototype.formatWith=function(){for(var i,t=this,n=0;n<arguments.length;n++)i=new RegExp("\\{"+n+"\\}","gi"),t=t.replace(i,arguments[n]);return t};$(function(){sv.helper.isPhoneGap?document.addEventListener("deviceready",sv.init):sv.init()});